#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Pre-push hook: Last line of defense against continuity errors
echo "üõ°Ô∏è  Running pre-push continuity check..."

# Check if Python is available
if ! command -v python3 >/dev/null 2>&1; then
    echo "‚ùå Python3 not found. Please install Python to run pre-push checks."
    exit 1
fi

# Check if scripts exist
if [ ! -f "scripts/continuity-check.py" ]; then
    echo "‚ö†Ô∏è  Continuity check script not found. Skipping pre-push check."
    exit 0
fi

# Run continuity check
echo "üîç Checking for continuity errors before push..."
python3 scripts/continuity-check.py

if [ $? -ne 0 ]; then
    echo ""
    echo "‚ùå PUSH BLOCKED: Continuity errors detected!"
    echo "üìù Fix the errors above before pushing."
    echo ""
    echo "‚ö†Ô∏è  To bypass (NOT RECOMMENDED):"
    echo "   git push --no-verify"
    echo ""
    echo "üí° Better solution:"
    echo "   1. Fix the continuity errors"
    echo "   2. Run 'make session-end' to update context"
    echo "   3. Commit the fixes"
    echo "   4. Push normally"
    exit 1
fi

echo "‚úÖ Continuity check passed. Proceeding with push..."